<!--
=====================================================
  SISTEMA DE INVENTARIO F√çSICO 2026
  ¬© Derechos reservados DAS Logistics Solutions S.A.C
  Programador: Anthony Carranza Paredes
=====================================================
-->

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario F√≠sico 2026</title>

<style>
:root{
  --azul:#0b3c5d;
  --azul-claro:#1d6fa5;
  --naranja:#f28c28;
  --gris:#f4f6f8;
  --texto:#1f2933;
  --asterisco:#9ca3af;
  --alerta:#dc2626;
}

*{box-sizing:border-box;font-family:Segoe UI,Tahoma,sans-serif}

body{margin:0;padding:20px;background:var(--gris);color:var(--texto)}

.logo-top{display:flex;justify-content:center;margin:10px 0 25px}
.logo-top img{height:70px}

.dni-bar{text-align:center;font-weight:700;color:var(--azul);margin-bottom:20px}

.login{
  max-width:420px;
  margin:80px auto;
  background:white;
  padding:25px;
  border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}

.tabs{
  display:flex;
  background:white;
  border-radius:14px;
  overflow:hidden;
  margin-bottom:20px;
  box-shadow:0 3px 8px rgba(0,0,0,.06);
}

.tab{
  flex:1;
  padding:14px;
  text-align:center;
  cursor:pointer;
  background:#e9edf1;
  font-weight:500;
}
.tab.active{
  background:white;
  color:var(--azul);
  border-bottom:4px solid var(--naranja);
}

.card{
  background:white;
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.07);
}

.hidden{display:none}

label{font-weight:600;margin-top:12px;display:block}
.req{color:var(--asterisco);margin-left:4px}

input,button{
  width:100%;
  padding:12px;
  margin-top:6px;
  font-size:15px;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  background:var(--azul);
  color:white;
  border:none;
  margin-top:18px;
}
button:hover{background:var(--azul-claro)}

.row{display:flex;gap:15px}
.col{flex:1}

.items-list{
  max-height:240px;
  overflow-y:auto;
  border:1px solid #ddd;
  margin-top:5px;
  border-radius:10px;
  background:white;
  position:relative;
  z-index:5;
}

.item-option{
  padding:10px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.item-option:hover{background:#f1f5f9}

.item-info{
  margin-top:12px;
  padding:12px;
  background:#f8fafc;
  border-left:4px solid var(--azul);
  border-radius:10px;
  font-size:14px;
}

.unidad-diferente{
  border:2px solid var(--alerta)!important;
  color:var(--alerta);
  font-weight:600;
}

.footer{
  text-align:center;
  margin-top:60px;
  color:#555;
}
.footer .titulo{
  font-size:22px;
  font-weight:700;
  color:var(--azul);
}
</style>
</head>

<body>

<div class="logo-top">
  <img src="logo_dassac.png">
</div>

<!-- LOGIN -->
<div id="login" class="login">
  <label>DNI <span class="req">*</span></label>
  <input id="dniInput">
  <button onclick="ingresar()">Ingresar</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

  <div class="dni-bar">
    DNI: <span id="dniMostrado"></span>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="mostrarTab('registrar',this)">Registrar</div>
    <div class="tab" onclick="mostrarTab('registros',this)">
      Mis Registros (<span id="contador">0</span>)
    </div>
  </div>

  <!-- REGISTRAR -->
  <div id="tab-registrar" class="card">

    <label>C√≥digo del Item <span class="req">*</span></label>
    <input id="codigo" onkeyup="filtrarItem()">
    <div id="listaItems" class="items-list hidden"></div>

    <!-- INFO ITEM -->
    <div id="infoItem" class="item-info hidden"></div>

    <label>Ubicaci√≥n <span class="req">*</span></label>
    <input id="ubicacion">

    <div class="row">
      <div class="col">
        <label>Cantidad <span class="req">*</span></label>
        <input id="cantidad" type="number" min="0">
      </div>
      <div class="col">
        <label>Unidad de Medida <span class="req">*</span></label>
        <input id="unidad" onkeyup="filtrarUnidad()">
        <div id="listaUnidades" class="items-list hidden"></div>
      </div>
    </div>

    <label>Observaciones (opcional)</label>
    <input id="obs">

    <button onclick="guardar()">Guardar</button>
  </div>

  <!-- REGISTROS -->
  <div id="tab-registros" class="card hidden">
    <button onclick="exportar()">üì• Exportar CSV</button>
    <div id="listaRegistros" style="margin-top:15px"></div>
  </div>

</div>

<div class="footer">
  <div class="titulo">Inventario F√≠sico 2026</div>
  ¬© Derechos reservados <strong>DAS Logistics Solutions S.A.C</strong><br>
  Programador: <strong>Anthony Carranza Paredes</strong>
</div>

<script src="datos_items.js"></script>

<script>
let DNI="";
let items=[];
let registros=[];
let unidadEsperada="";

const unidades=[
 "NIU","UND","PZA","PCS","PAR",
 "KG","G","TON",
 "L","ML","GAL",
 "M","CM","MM","M2","M3",
 "CAJ","PAQ","SAC","BOL","ROL",
 "JGO","KIT"
];

function ingresar(){
 if(!dniInput.value.trim()){alert("Ingrese DNI");return}
 DNI=dniInput.value.trim();
 dniMostrado.innerText=DNI;
 login.classList.add("hidden");
 app.classList.remove("hidden");
}

function mostrarTab(tab,el){
 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 el.classList.add("active");
 document.querySelectorAll("[id^='tab-']").forEach(t=>t.classList.add("hidden"));
 document.getElementById("tab-"+tab).classList.remove("hidden");
}

document.addEventListener("DOMContentLoaded",()=>{
 if(!window.catalogoCompleto){
   alert("Error: no se carg√≥ datos_items.js");
   return;
 }
 items=Object.entries(window.catalogoCompleto).map(([c,d])=>({
   codigo:c,
   descripcion:d.descripcion,
   ubicacion:d.ubicacion,
   saldo:d.saldo,
   unidad:d.unidad
 }));
});

/* AUTOCOMPLETE ITEM */
function filtrarItem(){
 const v=codigo.value.toLowerCase();
 if(v.length<2){listaItems.classList.add("hidden");return}
 listaItems.innerHTML=items
   .filter(i=>i.codigo.includes(v)||i.descripcion.toLowerCase().includes(v))
   .slice(0,10)
   .map(i=>`
     <div class="item-option" onmousedown="seleccionarItem('${i.codigo}')">
       <b>${i.codigo}</b> - ${i.descripcion}
     </div>
   `).join("");
 listaItems.classList.remove("hidden");
}

function seleccionarItem(c){
 const i=items.find(x=>x.codigo===c);
 codigo.value=c;
 ubicacion.value=i.ubicacion||"";
 cantidad.value=i.saldo||"";
 unidad.value=i.unidad||"";
 unidadEsperada=i.unidad||"";
 unidad.classList.remove("unidad-diferente");

 infoItem.innerHTML=`
   <b>${i.descripcion}</b><br>
   üìç Ubicaci√≥n esperada: ${i.ubicacion || "SIN"}<br>
   üì¶ Cantidad esperada: ${i.saldo} ${i.unidad}
 `;
 infoItem.classList.remove("hidden");

 listaItems.classList.add("hidden");
}

/* AUTOCOMPLETE UNIDAD */
function filtrarUnidad(){
 const v=unidad.value.toUpperCase();
 if(!v){listaUnidades.classList.add("hidden");return}
 listaUnidades.innerHTML=unidades
  .filter(u=>u.includes(v))
  .slice(0,8)
  .map(u=>`<div class="item-option" onmousedown="seleccionarUnidad('${u}')">${u}</div>`)
  .join("");
 listaUnidades.classList.remove("hidden");
}

function seleccionarUnidad(u){
 unidad.value=u;
 listaUnidades.classList.add("hidden");
 if(unidadEsperada && u!==unidadEsperada){
   unidad.classList.add("unidad-diferente");
 }else{
   unidad.classList.remove("unidad-diferente");
 }
}

function guardar(){
 if(!codigo.value||!ubicacion.value||!cantidad.value||!unidad.value){
   alert("Complete todos los campos obligatorios");
   return;
 }
 registros.push({
   codigo:codigo.value,
   cantidad:cantidad.value,
   unidad:unidad.value
 });
 actualizarRegistros();
 codigo.value=ubicacion.value=cantidad.value=unidad.value=obs.value="";
 infoItem.classList.add("hidden");
}

function actualizarRegistros(){
 contador.innerText=registros.length;
 listaRegistros.innerHTML=registros.map((r,i)=>`
   <div>${i+1}. <b>${r.codigo}</b> ‚Äì ${r.cantidad} ${r.unidad}</div>
 `).join("");
}

function exportar(){
 const fecha=new Date().toISOString().replace(/[:.]/g,"-");
 let csv="DNI,Codigo,Cantidad,Unidad\n";
 registros.forEach(r=>{
   csv+=`${DNI},${r.codigo},${r.cantidad},${r.unidad}\n`;
 });
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
 a.download=`inventario_${DNI}_${fecha}.csv`;
 a.click();
 registros=[];
 actualizarRegistros();
}
</script>

</body>
</html>
